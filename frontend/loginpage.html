<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login & Sign Up</title>

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .container{
      width:100%;
      max-width:850px;
      height:500px;
      background:#fff;
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 15px 50px rgba(0,0,0,0.25);
      position:relative;
    }

    /* UPDATED TO SMOOTH 1.8 SEC ANIMATION */
    .form-container{
      position:absolute;
      top:0;
      height:100%;
      width:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      transition:transform 1.8s cubic-bezier(.25,.8,.25,1), opacity 1.2s;
      padding:0 40px;
      background:#fff;
    }

    form{ width:100%; max-width:380px; display:flex; flex-direction:column; }

    h2{ font-size:2rem; margin-bottom:18px; text-align:left; font-weight:700; color:#111; }

    .input-group{ margin-bottom:14px; }
    input{
      width:100%;
      padding:12px 14px;
      border-radius:8px;
      border:1px solid #e0e0e0;
      background:#f6f6f6;
      font-size:14px;
    }
    input:focus{ outline:none; background:#fff; border-color:#000 }

    button{
      width:100%;
      padding:12px;
      border-radius:28px;
      background:#000;
      color:#fff;
      border:none;
      font-weight:700;
      cursor:pointer;
      margin-top:12px;
    }
    button:hover{ background:#222 }

    .toggle-text{ margin-top:14px; text-align:center; color:#444; }
    .toggle-link{ color:#000; font-weight:700; cursor:pointer }

    .small-link{ text-align:left; margin-top:6px; color:#222; cursor:pointer; text-decoration:underline; font-size:0.92rem; }
        .sign-in-container{ left:0; z-index:5; }
    .sign-up-container{ right:0; left:auto; transform:translateX(100%); z-index:3; }

    .container.sign-up-mode .sign-up-container{ transform:translateX(0); z-index:20; }
    .container.sign-up-mode .sign-in-container{ transform:translateX(-100%); z-index:5; }

    .forgot-container{
      left:50%;
      transform:translate(-50%, 0);
      z-index:2;
      opacity:0;
      visibility:hidden;
      transition: opacity 1.2s ease, visibility 1.2s;
      pointer-events:none;
    }


    .container.forgot-mode .forgot-container{
      transform:translate(-50%, 0);
      opacity:1;
      visibility:visible;
      z-index:30;
      pointer-events:auto;
    }


    .container.forgot-mode .sign-in-container{
      transform:translateX(-100%);
      z-index:5;
    }

    /* OVERLAY UPDATED TO 1.8s ANIMATION */
    .overlay-container{
      position:absolute;
      top:0;
      left:50%;
      width:50%;
      height:100%;
      overflow:hidden;
      transition:transform 1.8s cubic-bezier(.25,.8,.25,1);
      z-index:1;
    }
    .overlay{
      position:relative;
      left:-100%;
      width:200%;
      height:100%;
      background:linear-gradient(to right,#000,#161616);
      transition:transform 1.8s cubic-bezier(.25,.8,.25,1);
    }
    .overlay-panel{
      position:absolute;
      width:50%;
      height:100%;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding:0 30px;
      color:#fff;
      text-align:center;
    }

    .overlay-left{ left:0 }
    .overlay-right{ right:0 }

    .container.sign-up-mode .overlay-container{ transform:translateX(-100%); }
    .container.sign-up-mode .overlay{ transform:translateX(50%); }

    .container.forgot-mode .overlay-container{ transform:translateX(-100%); }
    .container.forgot-mode .overlay{ transform:translateX(100%); }

    @media (max-width:760px){
      .container{ max-width:100%; height:auto; padding:20px; }
      .form-container{ position:relative; width:100%; transform:none; padding:10px 20px; }
      .overlay-container{ display:none }
    }
  </style>
</head>

<body>
  <div class="container" id="container">

    <!-- LOGIN -->
    <div class="form-container sign-in-container" id="signInContainer">
      <form id="signInForm">
        <h2>Login</h2>

        <div class="input-group">
          <input id="signinEmail" type="email" placeholder="Email" required />
        </div>

        <div class="input-group">
          <input id="signinPassword" type="password" placeholder="Password" required />
        </div>

        <div class="small-link" id="showForgot">Forgot Password?</div>

        <button type="submit">Login</button>

        <p class="toggle-text">Don't have an account? <span class="toggle-link" id="toSignUp">Sign up</span></p>
      </form>
    </div>

    <!-- SIGN UP -->
    <div class="form-container sign-up-container" id="signUpContainer" aria-hidden="true">
      <form id="signUpForm">
        <h2>Sign Up</h2>

        <div class="input-group">
          <input id="signupUsername" type="text" placeholder="Username" required />
        </div>

        <div class="input-group">
          <input id="signupEmail" type="email" placeholder="Email" required />
        </div>

        <div class="input-group">
          <input id="signUpPassword" type="password" placeholder="Password" required />
        </div>

        <div class="input-group">
          <input id="confirmSignUpPassword" type="password" placeholder="Confirm Password" required />
        </div>

        <p id="passwordError" style="color:red;display:none;margin-bottom:6px;"></p>

        <button type="submit">Sign Up</button>

        <p class="toggle-text">Already have an account? <span class="toggle-link" id="toLogin">Login</span></p>
      </form>
    </div>
        <!-- FORGOT PASSWORD -->
    <div class="form-container forgot-container" id="forgotContainer" aria-hidden="true">
      <form id="forgotForm">
        <h2>Forgot Password</h2>

        <div class="input-group">
          <input id="forgotEmailInput" type="email" placeholder="Enter your email" required />
        </div>

        <button type="submit">Send Reset Link</button>

        <p class="toggle-text">Remembered? <span class="toggle-link" id="backToLogin">Back to Login</span></p>
      </form>
    </div>

    <!-- OVERLAY -->
    <div class="overlay-container" aria-hidden="true">
      <div class="overlay" role="presentation">
        <div class="overlay-panel overlay-left">
          <h1 style="font-size:28px;margin-bottom:8px">HELLO, FRIEND!</h1>
          <p style="max-width:260px">To keep connected with us, login with your personal info</p>
        </div>

        <div class="overlay-panel overlay-right">
          <h1 style="font-size:28px;margin-bottom:8px">WELCOME BACK!</h1>
          <p style="max-width:260px">Enter your personal details and start your journey with us</p>
        </div>
      </div>
    </div>
  </div>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>

    const showError = (message) => {
      alert(`Error: ${message}`);
    };

    const container = document.getElementById('container');
    const toSignUp = document.getElementById('toSignUp');
    const toLogin = document.getElementById('toLogin');
    const showForgot = document.getElementById('showForgot');
    const backToLogin = document.getElementById('backToLogin');

    function enterSignUp(){ container.classList.add('sign-up-mode'); container.classList.remove('forgot-mode'); }
    function enterLogin(){ container.classList.remove('sign-up-mode'); container.classList.remove('forgot-mode'); }
    function enterForgot(){ container.classList.add('forgot-mode'); container.classList.remove('sign-up-mode'); }

    toSignUp.onclick = enterSignUp;
    toLogin.onclick = enterLogin;
    showForgot.onclick = enterForgot;
    backToLogin.onclick = enterLogin;

    // SIGNUP
    document.getElementById('signUpForm').onsubmit = async(e)=>{
      e.preventDefault();
      let email = signupEmail.value;
      let password = signUpPassword.value;
      let confirm = confirmSignUpPassword.value;
      let username = signupUsername.value.trim();

      if(!username) {
        showError('Username is required');
        return;
      }

      if(password !== confirm){
        passwordError.style.display = "block";
        passwordError.textContent = "Passwords do not match!";
        return;
      }
      passwordError.style.display = "none";

      try{
        const userCred = await firebase.auth().createUserWithEmailAndPassword(email, password);
        
        // Initialize user in Firestore
        const backendUrl = "https://study-flow-ea7b.onrender.com";

        const response = await fetch('${backendUrl}/api/user/init', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            uid: userCred.user.uid,
            email: email,
            username: username
          })
        });

        if (!response.ok) {
          throw new Error('Failed to initialize user data');
        }

        alert("Account created!");
        enterLogin();
      }catch(err){
        console.error('Signup error:', err);
        showError(err.message || 'Signup failed');
      }
    };

    // LOGIN
    document.getElementById('signInForm').onsubmit = async(e)=>{
      e.preventDefault();
      let email = signinEmail.value;
      let password = signinPassword.value;

      try{
        const userCred = await firebase.auth().signInWithEmailAndPassword(email, password);
        alert("Login successful!");
        window.location.href = "index.html";
      }catch(err){
        console.error('Login error:', err);
        showError(err.message || 'Login failed');
      }
    };

    // FORGOT PASSWORD
    document.getElementById('forgotForm').onsubmit = async(e)=>{
      e.preventDefault();
      let email = forgotEmailInput.value;

      try{
        await firebase.auth().sendPasswordResetEmail(email);
        alert("Reset link sent to your email!");
        enterLogin();
      }catch(err){
        console.error('Password reset error:', err);
        showError(err.message || 'Failed to send reset email');
      }
    };
  </script>
</body>
</html>


